var main=function($){var _={settings:{preload:!1,slideDuration:500,layoutDuration:750,thumbnailsPerRow:2,mainSide:"right"},$window:null,$body:null,$main:null,$thumbnails:null,$viewer:null,$toggle:null,$navNext:null,$navPrevious:null,slides:[],current:null,locked:!1,keys:{27:function(){_.toggle()},38:function(){_.up()},40:function(){_.down()},32:function(){_.next()},39:function(){_.next()},37:function(){_.previous()}},initProperties:function(){_.$window=$(window),_.$body=$("body"),_.$thumbnails=$("#thumbnails"),_.$viewer=$('<div id="viewer"><div class="inner"><div class="nav-next"></div><div class="nav-previous"></div><div class="toggle"></div></div></div>').appendTo(_.$body),_.$navNext=_.$viewer.find(".nav-next"),_.$navPrevious=_.$viewer.find(".nav-previous"),_.$main=$("#main"),$('<div class="toggle"></div>').appendTo(_.$main),_.$toggle=$(".toggle")},initEvents:function(){var resizeTimeout;_.$window.on("load",(function(){_.$body.removeClass("is-preload-0"),window.setTimeout((function(){_.$body.removeClass("is-preload-1")}),100),window.setTimeout((function(){_.$body.removeClass("is-preload-2")}),100+Math.max(_.settings.layoutDuration-150,0))})),_.$window.on("resize",(function(){_.$body.addClass("is-preload-0"),window.clearTimeout(resizeTimeout),resizeTimeout=window.setTimeout((function(){_.$body.removeClass("is-preload-0")}),100)})),_.$viewer.on("touchend",(function(){breakpoints.active("<=medium")&&_.hide()})),_.$viewer.on("touchstart",(function(event){_.$viewer.touchPosX=event.originalEvent.touches[0].pageX,_.$viewer.touchPosY=event.originalEvent.touches[0].pageY})).on("touchmove",(function(event){if(null!==_.$viewer.touchPosX&&null!==_.$viewer.touchPosY){var diffX=_.$viewer.touchPosX-event.originalEvent.touches[0].pageX,diffY=_.$viewer.touchPosY-event.originalEvent.touches[0].pageY;boundary=20,delta=50,diffY<boundary&&diffY>-1*boundary&&diffX>delta?_.next():diffY<boundary&&diffY>-1*boundary&&diffX<-1*delta&&_.previous();var th=_.$viewer.outerHeight(),ts=_.$viewer.get(0).scrollHeight-_.$viewer.scrollTop();(_.$viewer.scrollTop()<=0&&diffY<0||ts>th-2&&ts<th+2&&diffY>0)&&(event.preventDefault(),event.stopPropagation())}})),_.$main.on("touchstart",(function(event){breakpoints.active("<=xsmall")||(_.$main.touchPosX=event.originalEvent.touches[0].pageX,_.$main.touchPosY=event.originalEvent.touches[0].pageY)})).on("touchmove",(function(event){if(!breakpoints.active("<=xsmall")&&null!==_.$main.touchPosX&&null!==_.$main.touchPosY){var diffX=_.$main.touchPosX-event.originalEvent.touches[0].pageX,diffY=_.$main.touchPosY-event.originalEvent.touches[0].pageY;switch(boundary=20,delta=50,result=!1,_.settings.mainSide){case"left":result=diffY<boundary&&diffY>-1*boundary&&diffX>delta;break;case"right":result=diffY<boundary&&diffY>-1*boundary&&diffX<-1*delta}result&&_.hide();var th=_.$main.outerHeight(),ts=_.$main.get(0).scrollHeight-_.$main.scrollTop();(_.$main.scrollTop()<=0&&diffY<0||ts>th-2&&ts<th+2&&diffY>0)&&(event.preventDefault(),event.stopPropagation())}})),_.$toggle.on("click",(function(){_.toggle()})),_.$toggle.on("touchend",(function(event){event.stopPropagation()})),_.$navNext.on("click",(function(){_.next()})),_.$navPrevious.on("click",(function(){_.previous()})),_.$body.on("keydown","input,select,textarea",(function(event){event.stopPropagation()})),_.$window.on("keydown",(function(event){breakpoints.active("<=xsmall")||event.keyCode in _.keys&&(event.stopPropagation(),event.preventDefault(),_.keys[event.keyCode]())}))},initViewer:function(){_.$thumbnails.on("click",".thumbnail",(function(event){var $this=$(this);event.preventDefault(),event.stopPropagation(),_.locked&&$this.blur(),_.switchTo($this.data("index"))})),_.$thumbnails.children().each((function(){var s,$this=$(this),$thumbnail=$this.children(".thumbnail");if(s={$parent:$this,$slide:null,$slideImage:null,$slideCaption:null,url:$thumbnail.attr("href"),loaded:!1},$this.attr("tabIndex","-1"),s.$slide=$('<div class="slide"><div class="caption"></div><div class="image"></div></div>'),s.$slideImage=s.$slide.children(".image"),s.$slideImage.css("background-image","").css("background-position",$thumbnail.data("position")||"center"),s.$slideCaption=s.$slide.find(".caption"),$this.children().not($thumbnail).appendTo(s.$slideCaption),_.settings.preload){$('<img src="'+s.url+'" />');s.$slideImage.css("background-image","url("+s.url+")"),s.$slide.addClass("loaded"),s.loaded=!0}_.slides.push(s),$thumbnail.data("index",_.slides.length-1)}))},init:function(){breakpoints({xlarge:["1281px","1680px"],large:["981px","1280px"],medium:["737px","980px"],small:["481px","736px"],xsmall:[null,"480px"]}),_.initProperties(),_.initViewer(),_.initEvents(),breakpoints.on(">xsmall",(function(){null===_.current&&_.switchTo(0,!0)}))},switchTo:function(index,noHide){if((_.current!=index||breakpoints.active("<=xsmall"))&&!_.locked){_.locked=!0,!noHide&&breakpoints.active("<=medium")&&_.hide();var oldSlide=null!==_.current?_.slides[_.current]:null,newSlide=_.slides[index];_.current=index,oldSlide&&(oldSlide.$parent.removeClass("active"),oldSlide.$slide.removeClass("active")),newSlide.$parent.addClass("active").focus();var f=function(){oldSlide&&oldSlide.$slide.detach(),newSlide.$slide.appendTo(_.$viewer),newSlide.loaded?window.setTimeout((function(){newSlide.$slide.addClass("active"),window.setTimeout((function(){_.locked=!1}),100)}),100):window.setTimeout((function(){newSlide.$slide.addClass("loading"),$('<img src="'+newSlide.url+'" />').on("load",(function(){newSlide.$slideImage.css("background-image","url("+newSlide.url+")"),newSlide.loaded=!0,newSlide.$slide.removeClass("loading"),newSlide.$slide.addClass("active"),window.setTimeout((function(){_.locked=!1}),100)}))}),100)};oldSlide?window.setTimeout(f,_.settings.slideDuration):f()}},next:function(){var i,c=_.current;i=c>=_.slides.length-1?0:c+1,_.switchTo(i)},previous:function(){var i,c=_.current,l=_.slides.length;i=c<=0?l-1:c-1,_.switchTo(i)},up:function(){if(!_.$body.hasClass("fullscreen")){var i,c=_.current,l=_.slides.length,tpr=_.settings.thumbnailsPerRow;i=c<=tpr-1?l-(tpr-1-c)-1:c-tpr,_.switchTo(i)}},down:function(){if(!_.$body.hasClass("fullscreen")){var i,c=_.current,l=_.slides.length,tpr=_.settings.thumbnailsPerRow;i=c>=l-tpr?c-l+tpr:c+tpr,_.switchTo(i)}},show:function(){_.$body.hasClass("fullscreen")&&(_.$body.removeClass("fullscreen"),_.$main.focus())},hide:function(){_.$body.hasClass("fullscreen")||(_.$body.addClass("fullscreen"),_.$main.blur())},toggle:function(){_.$body.hasClass("fullscreen")?_.show():_.hide()}};return _}(jQuery);main.init();